parameters:
  ArtifactDirectory: not-specified
  RepositoryUrl: not-specified
  GroupID:
  ArtifactID:
  BuildToolsPath: $(Pipeline.Workspace)/azure-sdk-build-tools
  JavaRepoRoot: $(Pipeline.Workspace)/azure-sdk-for-java
  StageOnly: false

steps:
  - ${{if eq(parameters.Target, 'Burner')}}:
    - task: PowerShell@2
      displayName: 'Publish to Burner Feed'
      inputs:
        pwsh: true
        workingDirectory: $(Agent.BuildDirectory)
        filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1
        arguments: >
          -ArtifactDirectory ${{ parameters.ArtifactDirector }}
          -GroupIDFilter ${{ parameters.GroupID }}
          -ArtifactIDFilter ${{ parameters.ArtifactID }}
          -RepositoryUrl https://pkgs.dev.azure.com/azure-sdk/public/_packaging/azure-sdk-$(Build.BuildID)/maven/v1
          -RepositoryUsername nobody
          -RepositoryPassword $(System.AccessToken)
          -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe
          -InformationAction Continue

  - ${{if eq(parameters.Target, 'JavaDevFeed')}}:
    - task: PowerShell@2
      displayName: 'Publish to Java Dev Feed'
      inputs:
        pwsh: true
        workingDirectory: $(Agent.BuildDirectory)
        filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1
        arguments: >
          -ArtifactDirectory ${{ parameters.ArtifactDirectory }}
          -GroupIDFilter ${{ parameters.GroupID }}
          -ArtifactIDFilter ${{ parameters.ArtifactID }}
          -RepositoryUrl ${{ parameters.RepositoryUrl }}
          -RepositoryUsername nobody
          -RepositoryPassword $(System.AccessToken)
          -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe
          -InformationAction Continue

  - ${{if eq(parameters.Target, 'AndroidDevFeed')}}:
    - task: PowerShell@2
      displayName: 'Publish to Andriod Public Dev Feed'
      inputs:
        pwsh: true
        workingDirectory: $(Agent.BuildDirectory)
        filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1
        arguments: >
          -ArtifactDirectory ${{ parameters.ArtifactDirectory }}
          -GroupIDFilter ${{ parameters.GroupID }}
          -ArtifactIDFilter ${{ parameters.ArtifactID }}
          -RepositoryUrl https://pkgs.dev.azure.com/azure-sdk/public/_packaging/azure-sdk-for-android/maven/v1
          -RepositoryUsername nobody
          -RepositoryPassword $(System.AccessToken)
          -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe
          -InformationAction Continue

  - ${{if eq(parameters.Target, 'MavenCentral')}}:

    # Invoke this way if we are publishing a specific artifact (usually used from
    # within universal pipelines).
    - ${{if and(not(parameters.GroupID, ''),not(parameters.ArtifactID, ''))}}:
      - task: PowerShell@2
        displayName: 'Publish to Maven Central'
        inputs:
          pwsh: true
          workingDirectory: $(Agent.BuildDirectory)
          filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1
          arguments: >
            -ArtifactDirectory ${{ parameters.ArtifactDirectory }}
            -GroupIDFilter ${{ parameters.GroupID }}
            -ArtifactIDFilter ${{ parameters.ArtifactID }}
            -RepositoryUrl https://oss.sonatype.org/service/local/staging/deploy/maven2/
            -RepositoryUsername azuresdk
            -RepositoryPassword $(azuresdk-sonatype-password)
            -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe
            -InformationAction Continue

    # Invoke this way if we are publishing all artifacts in a folder (usually used from
    # within partner release pipeline).
    - ${{if and(eq(parameters.GroupID, ''),eq(parameters.ArtifactID, ''))}}:
      - task: PowerShell@2
        displayName: 'Publish to Maven Central'
        inputs:
          pwsh: true
          workingDirectory: $(Agent.BuildDirectory)
          filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1
          arguments: >
            -ArtifactDirectory ${{ parameters.ArtifactDirectory }}
            -RepositoryUrl https://oss.sonatype.org/service/local/staging/deploy/maven2/
            -RepositoryUsername azuresdk
            -RepositoryPassword $(azuresdk-sonatype-password)
            -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe
            -InformationAction Continue
            -StageOnly:$$(StageOnly)